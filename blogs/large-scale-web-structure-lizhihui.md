大型网站技术架构 -- 核心原理与案例分析
--------------------------


大型网站系统特点:  

1. 高并发, 大流量; 
2. 高可用; 
3. 海量数据; 
4. 用户分布广, 网络状况复杂(运营商/跨国);  
5. 安全问题; 
6. 需求变化快, 发布频繁; 
7. 渐进式发展

网站架构设计误区:

1. 一味追随大公司解决方案;
2. 为了技术而技术, 脱离实际业务需求;
3. 企图通过技术解决所有问题. 



### 网站架构模式

#### 最经典的分层结构

比如 OSI 7层网络架构; 计算机硬件的设计; 硬件, 操作系统, 应用程序的分层等都是很好的例子.

特点 : 

每个层次分工合作, 可以分别进行开发维护, 层与层之间的耦合降低.

实践 : 

重点在于合理划分层次, 并设计良好的接口. 维护中需要严格遵循分层架构, 不能跨层或逆向调用.    

层次应该渐进式细化. 前期层数较少, 随业务发展, 逐步将过于臃肿的层次进行拆分.

实现上也可以考虑初期就规划出较为丰富的层次, 但并不实现而直接打穿, 这样可以在业务发展过程中更平滑的分层过渡.

#### 业务分割

分层是横向的叠加, 分割就是纵向的排列. 

特点 :

业务纵向分割成模块, 模块之间具有相对的独立性, 可以分别开发维护, 甚至部署. 

实践 :

分割也是渐进式的, 最初的时候是不需要分割的, 但在逐渐添加业务的时候, 就需要经常对业务特点进行分析, 代码逻辑中进行较为清晰
的分类, 这样在将来团队扩张后, 可以较为方便的将不同的业务进行拆分. 随着业务发展, 业务进行更合理的, 更细粒度的分割.

#### 分布式 

前两点的架构设计, 推出分布式的必要性.

分布式要面临的问题: 

* 模块间的远程调用问题
* 整个系统可用性降低的问题
* 分布式中数据和状态一致性的问题
* 开发维护成本上升问题


#### 集群

对于核心业务, 或高负载模块, 或关键模块, 需要引入集群来进行负载均衡并提高可用性

#### 缓存

缓存是将数据放在离计算最近的位置. 是改善软件性能的第一手端

使用缓存的两个条件: 

1. 数据访问热点不均衡. 
2. 被缓存的数据不会很快过期.

#### 异步

异步架构是典型生产者消费者模式, 两者不存在直接调用. 

特点 :  提高系统可用性,  加快网站响应速度,  消除并发访问高峰.

使用异步方式可能造成业务不能实时得到处理.

#### 冗余

#### 自动化

各种工作的自动化, 包括:

* 部署
* 代码管理
* 测试
* 安全检测
* 监控
* 报警
* 失效转椅
* 失效恢复
* 降级 (关闭部分非核心, 高成本的服务或接口)

#### 安全

加密技术, HTTPS, 防御技术, 风险控制等.


### 架构模式的应用 (新浪微博为例)






## 网站架构要素 

* 性能
* 可用性: 主要手段是冗余
* 伸缩性: 关系数据库难以做到大规模可伸缩集群, NoSQL对伸缩性支持较好.
* 扩展性: 衡量--加入新业务的时候, 是否可以对现有产品透明, 无太大影响.  手段--**事件驱动,分布式服务**
* 安全性

